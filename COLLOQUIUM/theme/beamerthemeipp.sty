% IPP presentation style for beamer package
% Copyright 2014 by M. Borchardt
% modified 2016 A. Kleiber

\RequirePackage{booktabs}
\RequirePackage{fontspec}
\RequirePackage{hyperref}
\RequirePackage{minted}
\RequirePackage{xcolor}
\RequirePackage{amsmath}
\RequirePackage{amsfonts}
\RequirePackage{amssymb}
\RequirePackage{siunitx}
\RequirePackage{stackrel}
\RequirePackage{changepage}

\RequirePackage{tikz}
\usetikzlibrary{positioning}

\RequirePackage{caption}
\RequirePackage{subcaption}
\captionsetup{labelformat=empty,labelsep=none}

\DeclareOptionBeamer{nowx}{\def\beamer@themeipp@wsxx{0}}
\DeclareOptionBeamer{wx}{\def\beamer@themeipp@wsxx{1}}

\DeclareOptionBeamer{noSt}{\def\beamer@themeipp@wsx{0}}
\DeclareOptionBeamer{St}{\def\beamer@themeipp@wsx{1}}
\ExecuteOptionsBeamer{St}

\DeclareOptionBeamer{noEurofusion}{\def\beamer@themeipp@eurofusion{0}}
\DeclareOptionBeamer{Eurofusion}{\def\beamer@themeipp@eurofusion{1}}
\ExecuteOptionsBeamer{noEurofusion}

\ProcessOptionsBeamer
\mode<presentation>

\usepackage[shadow=true]{beamerinnerthemerounded}

\def\acknowledgement{\centering\tiny\itshape%
    This work has been carried out within the framework of the EUROfusion Consortium and has received funding from the Euratom research and training programme 2014-2018 under grant agreement No. 633053. The views and opinions expressed herein do not necessarily reflect those of the European Commission.}

\usecolortheme{ipp}

\newfontfamily\hermannboldfont[Path=fonts/]{Hermann-Bold.otf}
\newcommand{\hermann}[1]{{\hermannboldfont #1}}

\AtBeginDocument{
  \def\insertframetitle{}
  \pgfdeclarehorizontalshading{beamer@topshade}{2pt}{%
    color(0pt)=(ippdark);
    color(\paperwidth)=(ipp)}
}

% Don't show navigation symbols
\beamertemplatenavigationsymbolsempty

\pgfdeclarehorizontalshading[ipplight,ipplight]%
                            {beamer@frametitleshade}{\paperheight}{%
  color(0pt)=(ipplight);
  color(\paperwidth)=(ipplight)}

\pgfdeclareimage[height=1cm]{LogoIPP}{logos/ipp.png}
\pgfdeclareimage[height=1cm]{LogoW7X}{logos/w7x.png}
\pgfdeclareimage[height=.7cm]{LogoEurope}{logos/europe.png}
\pgfdeclareimage[height=.7cm]{LogoEurofusion}%
                {logos/eurofusion.png}
\pgfdeclareimage[height=.6cm]{LogoHelmholtz}{logos/helmholtz_research.png}
\pgfdeclareimage[height=1cm]{LogoMinerva}%
                {logos/minerva.png}
\pgfdeclareimage[height=1cm]{LogoST}{logos/w7x.png}

\usesectionheadtemplate
  {\hfill\insertsectionhead}
  {\hfill\color{fg!50!bg}\insertsectionhead}

% no extra frame title
\defbeamertemplate*{frametitle}{ipp theme}{}

% Head
\defbeamertemplate*{headline}{ipp theme}
{%
  \leavevmode%
  \@tempdimb=1.1cm%
  \begin{pgfpicture}{.02pt}{0pt}{\paperwidth}{\@tempdimb}
    \usebeamercolor{frametitle right}
    \pgfpathrectangle{\pgfpointorigin}{\pgfpoint{\paperwidth}{\@tempdimb}}
    \pgfusepath{clip}
    \pgftext[left,base]{\pgfuseshading{beamer@frametitleshade}}
  \end{pgfpicture}
  \ifnum\theframenumber=1%
    \begin{beamercolorbox}[wd=\paperwidth,ht=0ex]{frametitle}
      \vbox to\@tempdimb{\vfil%
        \hspace*{1ex}%
      \pgfuseimage{LogoEurope}%
      \hspace*{\fill}\vfil}%
    \end{beamercolorbox}
    \begin{beamercolorbox}[wd=\paperwidth,ht=0ex]{frametitle}
      \vbox to\@tempdimb{\vfil%
        \hspace*{14ex}%
        \pgfuseimage{LogoHelmholtz}%
        \hspace*{\fill}\vfil}%
    \end{beamercolorbox}
    \begin{beamercolorbox}[wd=\paperwidth,ht=0ex]{frametitle}
      \vbox to\@tempdimb{\vfil%
        \hspace*{33ex}%
        \pgfuseimage{LogoMinerva}
        \hspace*{\fill}\vfil}%
    \end{beamercolorbox}
    \ifnum\beamer@themeipp@eurofusion=1%
      \begin{beamercolorbox}[wd=\paperwidth,ht=0ex]{frametitle}
        \vbox to\@tempdimb{\vfil%
          \hspace*{44ex}%
          \pgfuseimage{LogoEurofusion}%
          \hspace*{\fill}\vfil}%
      \end{beamercolorbox}
    \fi
  \else
    \ifnum\beamer@themeipp@wsxx=1%
      \begin{beamercolorbox}[wd=\paperwidth,ht=0ex]{frametitle}
        \vbox to\@tempdimb{\vfil\hspace*{1ex}%
        \pgfuseimage{LogoW7X}%
          \hspace*{\fill}\vfil}
      \end{beamercolorbox}
    \fi
  \fi
  \begin{beamercolorbox}[wd=\paperwidth,ht=0ex]{frametitle}
    \vbox to\@tempdimb{\vfil%
      \hspace*{\fill}%
      \pgfuseimage{LogoIPP}%
      \hspace*{1ex}\vfil}
  \end{beamercolorbox}
  \begin{beamercolorbox}[wd=\paperwidth,ht=0ex]{frametitle}%
    \vbox to\@tempdimb{\vfil%
      \ifnum\beamer@themeipp@wsxx=1%
        \hspace*{6em}%
      \else%
        \hspace*{2em}%
      \fi%
      \usebeamerfont{frametitle}\hbox{\insertframetitle}%
      \hspace*{\fill}\vfil}
  \end{beamercolorbox}
  \vskip-0.2pt
  \hbox to\paperwidth{\pgfuseshading{beamer@topshade}}
  \vskip-2pt
  \vskip-2ex
}

\defbeamertemplate*{footline}{ipp theme}
{%
  \leavevmode%
  \hbox{%
    \begin{beamercolorbox}[wd=\paperwidth,ht=2.5ex,dp=1.125ex,%
      leftskip=.3cm,rightskip=.3cm]{title in head/foot}%
      \usebeamerfont{author in head/foot}\insertshortauthor\hspace*{\fill}
      \usebeamerfont{title in head/foot}\insertshorttitle\hspace*{2em}
      \insertframenumber{} / \inserttotalframenumber
    \end{beamercolorbox}}%
  \vskip0pt%
}

\mode
<all>